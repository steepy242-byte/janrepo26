from flask import Flask, request, render_template
import os

app = Flask(__name__)
UPLOAD_FOLDER = "uploads"
FLAG = "FLAG{file_upload_extension_bypass}"

os.makedirs(UPLOAD_FOLDER, exist_ok=True)

@app.route("/", methods=["GET", "POST"])
def upload():
    message = ""
    flag = ""

    if request.method == "POST":
        file = request.files.get("file")

        if not file or file.filename == "":
            message = "No file selected"
        else:
            filename = file.filename
            filepath = os.path.join(UPLOAD_FOLDER, filename)
            file.save(filepath)

            # ‚ùå VULNERABLE LOGIC (CTF INTENDED)
            if not filename.lower().endswith(".jpg"):
                flag = FLAG
            else:
                message = "Only JPG files allowed!"

    return render_template("upload.html", message=message, flag=flag)

if __name__ == "__main__":
    app.run(host="0.0.0.0", port=8000, debug=True)
